"use client";

import { Card, CardHeader, CardTitle, CardContent } from "@/components/ui/card";
import {
  RadarChart,
  PolarGrid,
  PolarAngleAxis,
  PolarRadiusAxis,
  Radar,
  ResponsiveContainer,
  Tooltip
} from "recharts";
import type { VulnerabilityMetrics } from "@/lib/types";

type Props = {
  vulns: VulnerabilityMetrics;
};

export function VulnerabilityRadarChart({ vulns }: Props) {
  const data = [
    {
      metric: "Sem PK",
      value: Number((vulns.missingPrimaryKeyRatio * 100).toFixed(1))
    },
    {
      metric: "Sem FK",
      value: Number((vulns.tablesWithoutForeignKeysRatio * 100).toFixed(1))
    },
    {
      metric: "IDs nulos",
      value: Number((vulns.nullableKeyLikeColumnsRatio * 100).toFixed(1))
    }
  ];

  return (
    <Card className="h-72 neu-card">
      <CardHeader>
        <CardTitle className="glow-orange">Radar de vulnerabilidades estruturais (%)</CardTitle>
      </CardHeader>
      <CardContent className="h-56">
        <ResponsiveContainer width="100%" height="100%">
          <RadarChart data={data}>
            <PolarGrid stroke="#1f2937" />
            <PolarAngleAxis dataKey="metric" tick={{ fill: "#ff8a1f", fontSize: 10 }} />
            <PolarRadiusAxis tick={{ fill: "#9ca3af", fontSize: 9 }} stroke="#1f2937" />
            <Tooltip
              contentStyle={{
                background: "#0d1326",
                border: "1px solid rgba(255,122,0,0.35)",
                borderRadius: 12,
                fontSize: 11
              }}
            />
            <Radar dataKey="value" stroke="#ff8a1f" fill="rgba(255,122,0,0.28)" fillOpacity={0.6} />
          </RadarChart>
        </ResponsiveContainer>
      </CardContent>
    </Card>
  );
}
